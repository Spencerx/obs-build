<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
    "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<meta http-equiv="Content-Type" content="application/xhtml+xml; charset=UTF-8" />
<meta name="generator" content="AsciiDoc 10.2.1" />
<title>pbuild Reference Guide</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overridden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install(2);
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>pbuild Reference Guide</h1>
<div id="toc">
  <div id="toctitle">Table of Contents</div>
  <noscript><p><b>JavaScript must be enabled in your browser to display the table of contents.</b></p></noscript>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_goals">1. Goals</h2>
<div class="sectionbody">
</div>
</div>
<div class="sect1">
<h2 id="_design">2. Design</h2>
<div class="sectionbody">
<div class="paragraph"><p>The pbuild tool is a level above "the build script" called "build". "build" is handling single build jobs, while
pbuild is managing the dependencies between this build jobs. Both can get executed on any Linux system directly.</p></div>
<div class="paragraph"><p>pbuild is processing local sources, but may download remote sources and binaries when referenced.
The local sources can get managed by any source revision management tool (eg. git).</p></div>
<div class="paragraph"><p>The tasks of the build script are:
* Building a defined and reproducable environement for one build job
* Calling the build tool for any supported format (rpm, deb, kiwi image, docker, &#8230;)
* Calling validations as provided by the build environement
* Extract build results
* Parse dependencies in binaries and build description files</p></div>
<div class="paragraph"><p>The tasks of pbuild are:
* calculating the dependencies between the build jobs for a build order
* calculating the need of rebuilds due to changed sources or dependencies
* manage multiple running build jobs in the background
* organize build results on the disk
* download remote assets (sources or binaries)</p></div>
<div class="sect2">
<h3 id="_filesystem_structure">2.1. Filesystem Structure</h3>
<div class="paragraph"><p>pbuild expects to get call in a directory where it&#8217;s project configuration files are living. Package sources
live in directories inside of this project directory:</p></div>
<div class="ulist"><ul>
<li>
<p>
Top directory
</p>
<div class="ulist"><ul>
<li>
<p>
Package A
</p>
<div class="ulist"><ul>
<li>
<p>
source files
</p>
</li>
</ul></div>
</li>
<li>
<p>
Package B
</p>
<div class="ulist"><ul>
<li>
<p>
source files
</p>
</li>
</ul></div>
</li>
<li>
<p>
&#8230;
</p>
</li>
<li>
<p>
_pbuild
</p>
</li>
<li>
<p>
_config
</p>
</li>
<li>
<p>
_build.&lt;preset&gt;
</p>
<div class="ulist"><ul>
<li>
<p>
_jobhistory
</p>
</li>
<li>
<p>
Package A results
</p>
<div class="ulist"><ul>
<li>
<p>
Build results
</p>
</li>
</ul></div>
</li>
<li>
<p>
Package B results
</p>
<div class="ulist"><ul>
<li>
<p>
Build results
</p>
</li>
</ul></div>
</li>
<li>
<p>
.pbuild
</p>
</li>
</ul></div>
</li>
</ul></div>
</li>
</ul></div>
<div class="sect3">
<h4 id="_config">2.1.1. _config</h4>
<div class="paragraph"><p>Can define build configurations. Usually defaults from a distribution are used, but this file can provide
additional rules. These define which packages need to become available in the build environment, macro definitions
and many more. See the build config topic for a detailed list.</p></div>
</div>
<div class="sect3">
<h4 id="_pbuild">2.1.2. _pbuild</h4>
<div class="paragraph"><p>This file defines one or more presets. A preset defines which</p></div>
<div class="ulist"><ul>
<li>
<p>
distribution configuration
</p>
</li>
<li>
<p>
repositories
</p>
</li>
<li>
<p>
hardware architectures
</p>
</li>
</ul></div>
</div>
<div class="sect3">
<h4 id="_build_lt_preset_gt">2.1.3. _build.&lt;preset&gt;</h4>
<div class="paragraph"><p>contains all binaries for the given preset. These are either downloaded or build local. Additional underscore prefixed
files contain informations about the build history and current states of the build.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_important_options">2.2. Important Options</h3>
<div class="paragraph"><p>pbuild does not need any parameters by default. It will build inside of KVM by default which can work
as user (non-root) in a proper environment. KVM will also ensure that the correct kernel is running
during build. However, builds in chroot or containern is also possible via</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--vm-type=chroot
--vm-type=docker</code></pre>
</div></div>
<div class="paragraph"><p>Define the amount of provided memory in KVM via</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--vm-memory=MEGABYTES</code></pre>
</div></div>
<div class="paragraph"><p>The build environment disk space can get defined via</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--vm-disk-size=MEGABYTES</code></pre>
</div></div>
<div class="paragraph"><p>The KVM is fully isolated by default. This ensures that the build can become fully reproducibile and
also that no attack by using untrusted sources or binaries can happen. However, one may want to
use remote resources during build. In that case network access can get enabled via</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--vm-network</code></pre>
</div></div>
<div class="paragraph"><p>Keep in mind that this can get usually avoided by using remote assets instead.</p></div>
</div>
<div class="sect2">
<h3 id="_important_debugging_options">2.3. Important Debugging Options</h3>
<div class="paragraph"><p>pbuild always creates a consistent state. That means it may not build actually anything, when the
last build result look current. One can enforce a rebuild by using:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--rebuild &lt;PACKAGE&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The build log is by default only stored on disk. The live build log can be made available by
using the</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--showlog</code></pre>
</div></div>
<div class="paragraph"><p>option. If you want to debug a problem with a single package, you can use the</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--single &lt;PACKAGE&gt;</code></pre>
</div></div>
<div class="paragraph"><p>option to make pbuild only look at the specified package. This also triggers an rebuild
of the package. It often makes sense to use</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--single &lt;PACKAGE&gt; --shell-after-fail</code></pre>
</div></div>
<div class="paragraph"><p>to get a shell prompt in case a build failure occurs.</p></div>
<div class="paragraph"><p>Alternatively, one can reuse last build enviroment or create a new one by using the</p></div>
<div class="literalblock">
<div class="content">
<pre><code>--shell</code></pre>
</div></div>
<div class="paragraph"><p>option. This will give a prompt after the environment has been initialized.</p></div>
<div class="paragraph"><p>Extra packages needed for debugging can be specified with</p></div>
<div class="literalblock">
<div class="content">
<pre><code>-x binary_package</code></pre>
</div></div>
<div class="paragraph"><p>(eg. gdb, strace, valgrind or assumed missing dependencies for testing).</p></div>
</div>
<div class="sect2">
<h3 id="_remote_assets">2.4. Remote Assets</h3>
<div class="paragraph"><p>Remote Assets can be defined inside of the build descriptions. They are resources from a remote
servers and will be downloaded and validated by pbuild before the corresponding build is started.</p></div>
<div class="paragraph"><p>Supported protocols for resources using an url are:</p></div>
<div class="ulist"><ul>
<li>
<p>
http
</p>
</li>
<li>
<p>
https
</p>
</li>
<li>
<p>
git+http
</p>
</li>
<li>
<p>
git+https
</p>
</li>
</ul></div>
<div class="paragraph"><p>URLs for git support a revision specified as URL fragment. This can be a commit hash
or a branch name. For example git+https://github.com/openSUSE/example#main
The default is not to include the .git directory. If it is needed at build time, the
"withmeta" pseudo query parameter can be added.</p></div>
<div class="paragraph"><p>This depends on the build description format as described below.</p></div>
<div class="sect3">
<h4 id="_rpm_spec_files">2.4.1. rpm spec files</h4>
<div class="paragraph"><p>Source lines in spec files can declare remote assets. Rpm is already supporting to use
an URL as source definition. A comment before such a line marks it as remote asset for pbuild:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>#!RemoteAsset
Source: &lt;URL&gt;</code></pre>
</div></div>
<div class="paragraph"><p>It is also possible to specify a checksum to make sure that the asset is correct.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>#!RemoteAsset: &lt;CHECKSUM&gt;
Source: &lt;URL&gt;</code></pre>
</div></div>
<div class="paragraph"><p>If the source file name should be different from the last component of the url path, the
url can also be specified as argument of the RemoteAsset line:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>#!RemoteAsset: &lt;URL&gt; [&lt;CHECKSUM&gt;]
Source: &lt;FILENAME&gt;</code></pre>
</div></div>
<div class="paragraph"><p>A tar ball will be created at build time automatically, if the source is a directory
(like with git URLs) and the FILENAME is a tar ball.</p></div>
</div>
<div class="sect3">
<h4 id="_kiwi_build_description">2.4.2. kiwi build description</h4>
<div class="paragraph"><p>The kiwi format is not supporting remote source specifications, but they can be
specified via XML comments.</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;!-- OBS-RemoteAsset: &lt;URL&gt; --&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The resulting downloaded file can be copied into the image using</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;!-- OBS-CopyToImage: &lt;source&gt; &lt;destination&gt; --&gt;</code></pre>
</div></div>
<div class="paragraph"><p>The kiwi profile name is added to container names by default. This can be
disabled via</p></div>
<div class="literalblock">
<div class="content">
<pre><code>&lt;!-- OBS-DoNotAppendProfileToContainername --&gt;</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_dockerfile_description">2.4.3. Dockerfile description</h4>
<div class="paragraph"><p>Remote assets that will be downloaded before the build can be added via the
comment <code>#!RemoteAssetUrl: https://my.url/asset.tar</code>. <code>pbuild</code> will fetch the
asset before the build and will make it available in the buildroot so that the
asset can copied into the container as follows:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>----
#!RemoteAssetUrl: https://my.url/asset.tar
COPY asset.tar .
RUN tar -xvzf asset.tar
----</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_arch_linux_pkgbuild">2.4.4. Arch Linux PKGBUILD</h4>
<div class="paragraph"><p>PKGBuild files already contain the needed URLs and Checksums, so no extra
treatment is needed.</p></div>
</div>
<div class="sect3">
<h4 id="_fedpkg_sources_file">2.4.5. FedPkg "sources" file</h4>
<div class="paragraph"><p>The sources file contains a list of file names with checksums. PBuild will
automatically download the missing files from a FedPkg Server that needs
to be configured in the project config via the "AssetsURL:" directive or set
with the "--assets" option.</p></div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_about_the_build_configuration">3. About the Build Configuration</h2>
<div class="sectionbody">
<div class="paragraph"><p>The build configuration syntax describes the build environment
used for building packages. It is used to:</p></div>
<div class="ulist"><ul>
<li>
<p>
Switch on or off certain features during the build
</p>
</li>
<li>
<p>
Decide which packages are installed during build
</p>
</li>
<li>
<p>
Resolve dependency problems like when there are multiple providers
for a dependency
</p>
</li>
<li>
<p>
Handle user decisions like macro settings
</p>
</li>
</ul></div>
<div class="sect2">
<h3 id="_configuration_file_syntax">3.1. Configuration File Syntax</h3>
<div class="paragraph"><p>The syntax is basically the same as in RPM spec files. However, it is
independent of the used packaging format. You can use spec file
features like macros or conditions in the configuration.</p></div>
<div class="paragraph"><p>All lines have the form:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>keyword: arguments</code></pre>
</div></div>
<div class="paragraph"><p>Use <code>%if</code> or <code>%ifarch</code> if the line should only be used in some condition</p></div>
<div class="paragraph"><p>Many keywords like <code>Require</code> or <code>BuildFlags</code> do not replace existing
data, but add to it. This means you can have multiple <code>BuildFlags</code>
lines instead of having one line with all the flags you need.</p></div>
<div class="paragraph"><p>You can prepend an exclamation mark <code>!</code> to the argument to remove
an existing entry from the data.</p></div>
</div>
<div class="sect2">
<h3 id="_available_keywords_in_project_configuration">3.2. Available Keywords in Project Configuration</h3>
<div class="paragraph"><p>The following list contains all the allowed keywords in the project
configuration:</p></div>
<div class="sect3">
<h4 id="_assetsurl_type_url">3.2.1. AssetsURL: TYPE@URL</h4>
<div class="paragraph"><p>Define a url for automatic asset downloading. Supported types
are currently <code>fedpkg</code> and <code>goproxy</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_binarytype_type">3.2.2. BinaryType: TYPE</h4>
<div class="paragraph"><p>The binary type is the format of the packages that make up the build
environment. This is usually set automatically depending on the recipe
type and preinstall package list.
Currently understood values are: <code>rpm</code>, <code>deb</code>, and <code>arch</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_buildengine_engine">3.2.3. BuildEngine: ENGINE</h4>
<div class="paragraph"><p>Use an alternative build engine. Examples are <code>mock</code> (for Fedora and
Red Hat) and <code>debootstrap</code> (for Debian), <code>debbuild</code> (to build debian
packages with spec files), <code>podman</code> (container builds).</p></div>
<div class="paragraph"><p>Here is an example config for <code>debbuild</code>:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Type: spec
Repotype: debian
Binarytype: deb
BuildEngine: debbuild
Support: pax debbuild</code></pre>
</div></div>
</div>
<div class="sect3">
<h4 id="_buildflags_flag_value">3.2.4. BuildFlags: FLAG[:VALUE]</h4>
<div class="paragraph"><p>The BuildFlags keyword defines flags for the build process. The
following values for FLAG are usable.</p></div>
<div class="ulist"><ul>
<li>
<p>
vmfstype:TYPE
</p>
</li>
</ul></div>
<div class="paragraph"><p>Defines a specific file system when building inside of a VM. Possible
values are <code>ext2</code>, <code>ext3</code>, <code>ext4</code>, <code>btrfs</code>, <code>xfs</code>, <code>reiserfs</code> (v3).</p></div>
<div class="ulist"><ul>
<li>
<p>
vmfsoptions:OPTIONS
</p>
</li>
</ul></div>
<div class="paragraph"><p>Sets options for file system creation. Currently only the <code>nodirindex</code>
option is supported, which disables directory indexing for ext file
systems. This makes file ordering inside of directories reproducible
but may have a negative performance impact.</p></div>
<div class="ulist"><ul>
<li>
<p>
kiwiprofile:PROFILE
</p>
</li>
</ul></div>
<div class="paragraph"><p>Selects the profiles to build in kiwi appliance builds.</p></div>
<div class="ulist"><ul>
<li>
<p>
logidlelimit:SECONDS
</p>
</li>
</ul></div>
<div class="paragraph"><p>Build jobs which do not create any output are aborted after some time.
This flag can be used to modify the limit.</p></div>
<div class="ulist"><ul>
<li>
<p>
excludebuild:PACKAGE
</p>
</li>
</ul></div>
<div class="paragraph"><p>Exclude a package from building. If a package builds multiple flavors
("multibuild"), the corresponding flavor can be specified via the
<code>package:flavor</code> syntax.</p></div>
<div class="ulist"><ul>
<li>
<p>
onlybuild:PACKAGE
</p>
</li>
</ul></div>
<div class="paragraph"><p>This can be used to maintain a whitelist of packages to be built.
All other packages will turn to excluded state (and the old build
results will be erased!).</p></div>
<div class="ulist"><ul>
<li>
<p>
ccachetype:TYPE
</p>
</li>
</ul></div>
<div class="paragraph"><p>Defines the ccache implementation, possible values are: <code>ccache</code>, <code>sccache</code>.</p></div>
<div class="ulist"><ul>
<li>
<p>
useccache:PACKAGE
</p>
</li>
</ul></div>
<div class="paragraph"><p>Configure usage of ccache when building the specified package.</p></div>
<div class="ulist"><ul>
<li>
<p>
obsgendiff
</p>
</li>
</ul></div>
<div class="paragraph"><p>OBS can run an external program that has access to the current build and
the previously successful result, e.g. to generate a difference or a
changelog from the diff.</p></div>
<div class="paragraph"><p>build will run all scripts in /usr/lib/build/obsgendiff.d/ on the build
host (not in the %buildroot) when this flag is set. If one of the
scripts fails to run or no scripts are found, then the overall build
fails. I.e. if BuildFlags: obsgendiff is set, then you must provide at
least one script in /usr/lib/build/obsgendiff.d/, otherwise your build
will fail.</p></div>
<div class="paragraph"><p>A common use case for obsgendiff is to run release-compare after the
build.</p></div>
<div class="ulist"><ul>
<li>
<p>
setvcs
</p>
</li>
</ul></div>
<div class="paragraph"><p>Adds the SCM URL to binary results when the package sources are managed
via the scmsync mechanic. The url is written into the VCS tag of rpms
when enabling this functionality.</p></div>
<div class="ulist"><ul>
<li>
<p>
sbom:FORMAT
</p>
</li>
</ul></div>
<div class="paragraph"><p>Enables generation of SBOM (Software Bill Of Material) data. Supported
formats are spdx and cyclonedx.</p></div>
<div class="ulist"><ul>
<li>
<p>
container-compression-format:FORMAT
</p>
</li>
</ul></div>
<div class="paragraph"><p>Sets a compression format for container layers. Possible values are <code>gzip</code>, <code>zstd</code>,
<code>zstd:chunked</code>. The usage of values other than gzip is only supported by the
podman engine.</p></div>
<div class="ulist"><ul>
<li>
<p>
container-build-format:FORMAT
</p>
</li>
</ul></div>
<div class="paragraph"><p>For podman container builds, it specifies the container config format. Possible values
are <em>docker</em> and <em>oci</em>. The default is <em>docker</em>. The <em>docker</em> format allows a few
extensions like ONBUILD, SHELL, DOMAINNAME, COMMENT, HEALTHCHECK amongst others.</p></div>
</div>
<div class="sect3">
<h4 id="_conflict_package">3.2.5. Conflict: PACKAGE</h4>
<div class="paragraph"><p>Specify that a package must not be installed in the build environment.</p></div>
</div>
<div class="sect3">
<h4 id="_conflict_package_a_package_b">3.2.6. Conflict: PACKAGE_A:PACKAGE_B</h4>
<div class="paragraph"><p>Specify a synthetic conflict between to packages.</p></div>
</div>
<div class="sect3">
<h4 id="_constraint_selector_string">3.2.7. Constraint: SELECTOR STRING</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/caution.png" alt="Caution" />
</td>
<td class="content">OBS only</td>
</tr></table>
</div>
<div class="paragraph"><p>Define build constraints for build jobs. The selector is a
colon-separated list which gets a string assigned. See the build job
constraints page for details.</p></div>
</div>
<div class="sect3">
<h4 id="_distmacro_name_value">3.2.8. DistMacro: NAME VALUE</h4>
<div class="paragraph"><p>Define a macro to be used when parsing the spec files of packages.
This is similar to using a <code>Macros:</code> section with the difference
that the macro will not be written to the .rpmmacros file. It should
therefore be used for macros that come from packages of the
distributions.</p></div>
<div class="paragraph"><p>Note that the lines of the project config are macro expanded while
parsing, so you have to use <code>%%</code> for a literal percent sign in
the value.</p></div>
</div>
<div class="sect3">
<h4 id="_expandflags_flag_value">3.2.9. ExpandFlags: FLAG[:VALUE]</h4>
<div class="paragraph"><p>Flags which modify the behaviour during dependency resolution.</p></div>
<div class="ulist"><ul>
<li>
<p>
unorderedimagerepos
</p>
</li>
</ul></div>
<div class="paragraph"><p>The priority of repositories defined in an image build is usually
important. This is to avoid switching repositories when the same package
is available in multiple repositories. However, it might be wanted to
ignore that and just pick the highest version. This can be achieved by
defining this flag</p></div>
<div class="ulist"><ul>
<li>
<p>
preinstallexpand
</p>
</li>
</ul></div>
<div class="paragraph"><p>Preinstall also all dependencies of a preinstalled package.
Instead of manually listing all packages for a working package tool
one can just install dependencies of it. However, these might be
more then actually needed depending on the distribution.</p></div>
<div class="ulist"><ul>
<li>
<p>
module:NAME-STREAM
</p>
</li>
</ul></div>
<div class="paragraph"><p>Enable Red Hat-specific module support in repo md repositories. By
default, no module is used, so every module needed needs to be
specified in the configuration. To remove a module, add an exclamation mark
(!) as prefix.</p></div>
<div class="ulist"><ul>
<li>
<p>
dorecommends
</p>
</li>
</ul></div>
<div class="paragraph"><p>Try to install all recommended packages. Packages with dependency conflicts
are ignored.</p></div>
<div class="ulist"><ul>
<li>
<p>
dosupplements
</p>
</li>
</ul></div>
<div class="paragraph"><p>Try to install all supplemented packages. Packages with dependency conflicts
are ignored. This has the downside that new packages can cause different
dependency expansion, so this should only be enabled for special use
cases.</p></div>
<div class="ulist"><ul>
<li>
<p>
ignoreconflicts
</p>
</li>
</ul></div>
<div class="paragraph"><p>Ignore defined conflicts of packages. By default these are reported as unresolvable.
This switch may be useful when packages get not installed in the build environment,
but getting processed afterwards. That tool, eg. some image building tool, must be
able to handle the situation (eg. by just using a subset of the packages).</p></div>
<div class="ulist"><ul>
<li>
<p>
kiwi-nobasepackages
</p>
</li>
</ul></div>
<div class="paragraph"><p>Do not put the require/support/preinstall packages in the repositories
offered to the kiwi build tool. This should have been the default.</p></div>
<div class="ulist"><ul>
<li>
<p>
keepfilerequires
</p>
</li>
</ul></div>
<div class="paragraph"><p>Dependencies on files are only fulfilled if matching FileProvides are specified
in the project configuration. If those are missing, the dependency results in
an "unresolvable" state for directly required files or in silent breaking of the
dependency for indirectly required files. With this option, all file requires are
honoured by default and lead to "unresolvable" if there are no matching FileProvides defined.</p></div>
</div>
<div class="sect3">
<h4 id="_exportfilter_regex_architectures">3.2.10. ExportFilter: REGEX ARCHITECTURES</h4>
<div class="paragraph"><p>The export filter can be used to export build results from one
architecture to others. This is required when one architecture needs
packages from another architecture for building. The REGEX placeholder
must match the resulting binary name of the package. It will export it
to all listed scheduler architectures. Exported packages are not
used in the built architecture by default, add a <code>.</code> pseudo architecture
to also use them locally.</p></div>
</div>
<div class="sect3">
<h4 id="_fileprovides_file_packages">3.2.11. FileProvides: FILE PACKAGES</h4>
<div class="paragraph"><p>Due to memory consumption reasons dependencies to files as supported
by rpm are ignored by default. As a workaround, FileProvides can be
used to tell the systems which packages contain a file. The file needs
to have the full path.</p></div>
</div>
<div class="sect3">
<h4 id="_hostarch_host_arch">3.2.12. HostArch: HOST_ARCH</h4>
<div class="paragraph"><p>This is used for cross builds. It defines the host architecture used for
building, while the scheduler architecture remains the target
architecture.</p></div>
</div>
<div class="sect3">
<h4 id="_ignore_package_or_dependency">3.2.13. Ignore: PACKAGE_OR_DEPENDENCY</h4>
<div class="paragraph"><p>Ignore can be used to break dependencies. This can be useful to reduce
the number of needed packages or to break cyclic dependencies. If a
package is specified, all capabilities provided by the package are
ignored.</p></div>
<div class="paragraph"><p>Be careful with this feature as breaking dependencies can have unwanted
results. It is usually better to limit its usage by also specify the
originating package as described in the following section.</p></div>
</div>
<div class="sect3">
<h4 id="_ignore_origin_package_package_or_dependency">3.2.14. Ignore: ORIGIN_PACKAGE:PACKAGE_OR_DEPENDENCY</h4>
<div class="paragraph"><p>Ignore a dependency coming from ORIGIN_PACKAGE. See the previous section
for more details.</p></div>
</div>
<div class="sect3">
<h4 id="_keep_packages">3.2.15. Keep: PACKAGES</h4>
<div class="paragraph"><p>To eliminate build cycles the to-be-built packages are not installed by
default. Keep can be used to overwrite this behavior. It is usually needed
for packages like <code>make</code> that are used to build itself. Preinstalled
packages are automatically kept, as the package installation program needs
to work all the time.</p></div>
</div>
<div class="sect3">
<h4 id="_macros">3.2.16. Macros:</h4>
<div class="paragraph"><p>Defines the start of a literal macros block. The block is ended
by either reaching the end of the config or by a literal
<code>Macros:</code> line. See the section about macro definitions below for
more information.</p></div>
</div>
<div class="sect3">
<h4 id="_optflags_target_arch_flags_rpm_only">3.2.17. OptFlags: TARGET_ARCH FLAGS (RPM only)</h4>
<div class="paragraph"><p>Optflags exports compiler flags to the build by adding lines to rpm&#8217;s
<code>rpmrc</code> file. They will only have an effect when the spec file is using
<code>$RPM_OPT_FLAGS</code> or <code>%{optflags}</code>. The target architecture may be set
to <code>*</code> to affect all architectures.</p></div>
</div>
<div class="sect3">
<h4 id="_order_package_a_package_b">3.2.18. Order: PACKAGE_A:PACKAGE_B</h4>
<div class="paragraph"><p>The build script takes care about the installation order if they are
defined via dependencies inside of the packages. However, there might be
dependency loops (reported during setup of the build system) or missing
dependencies. The Order statement can be used then to give a hint where
to break the loop.</p></div>
<div class="paragraph"><p>The package in PACKAGE_A will get installed before the package in
PACKAGE_B.</p></div>
</div>
<div class="sect3">
<h4 id="_patterntype_type">3.2.19. Patterntype: TYPE</h4>
<div class="paragraph"><p>Defines the pattern format. Valid values are: <code>none</code> (default), <code>ymp</code>,
<code>comps</code>. Multiple types can be specified.</p></div>
</div>
<div class="sect3">
<h4 id="_prefer_package">3.2.20. Prefer: PACKAGE</h4>
<div class="paragraph"><p>In case multiple packages satisfy a dependency, the dependency expansion
will fail. This is unlike like most package managing tools, which just
pick one of the package. It is done that way to provide reproducible
builds and reduce the chance of surprising changes when new packages
are added to the repository.
The Prefer directive lists packages to be preferred in case a choice exists.
When the package name is prefixed with a minus sign, it is treated
as a de-prefer.</p></div>
</div>
<div class="sect3">
<h4 id="_prefer_origin_package_package">3.2.21. Prefer: ORIGIN_PACKAGE:PACKAGE</h4>
<div class="paragraph"><p>It is possible to define the prefer only when the dependency comes
from the specified originating package.</p></div>
</div>
<div class="sect3">
<h4 id="_preinstall_package">3.2.22. Preinstall: PACKAGE</h4>
<div class="paragraph"><p>This is used to specify packages needed to run the package installation
program. These packages are unpacked so that the native installation
program can be used to install the build environment.
Included scripts are not executed during this phase. However, these
packages will be re-installed later on including script execution.</p></div>
</div>
<div class="sect3">
<h4 id="_publishfilter_regexp_regexp">3.2.23. PublishFilter: REGEXP [REGEXP]</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/caution.png" alt="Caution" />
</td>
<td class="content">OBS only</td>
</tr></table>
</div>
<div class="paragraph"><p>Limits the published binary packages in public repositories. Packages
that match any REGEXP will not be put into the generated repository.</p></div>
<div class="paragraph"><p>There can be only one line of PublishFilter for historic reasons.
However, multiple REGEXP can be defined.</p></div>
</div>
<div class="sect3">
<h4 id="_publishflags_flag_value">3.2.24. PublishFlags: FLAG[:VALUE]</h4>
<div class="admonitionblock">
<table><tr>
<td class="icon">
<img src="./images/icons/caution.png" alt="Caution" />
</td>
<td class="content">OBS only</td>
</tr></table>
</div>
<div class="paragraph"><p>Flags which modify the behaviour during repository generation.</p></div>
<div class="ulist"><ul>
<li>
<p>
create_empty
</p>
</li>
</ul></div>
<div class="paragraph"><p>Create a repository even with no content, but with meta data.</p></div>
<div class="ulist"><ul>
<li>
<p>
noearlykiwipublish
</p>
</li>
</ul></div>
<div class="paragraph"><p>Only publish kiwi build results after entire repository has finished
building. Without this kiwi build results get published immediately
after the build is finished.</p></div>
<div class="ulist"><ul>
<li>
<p>
nofailedpackages
</p>
</li>
</ul></div>
<div class="paragraph"><p>Block publishing if any build result was failed, broken, or
unresolvable. This is evaluated individually for each architecture. That
means, packages can be published for an architecture on which it builds,
even if a package fails to build on another architecture.</p></div>
<div class="ulist"><ul>
<li>
<p>
withreports
</p>
</li>
</ul></div>
<div class="paragraph"><p>Also publish internal content tracking files (.report files).</p></div>
<div class="ulist"><ul>
<li>
<p>
withsbom
</p>
</li>
</ul></div>
<div class="paragraph"><p>Also publish SBOM data in the repostory. Container SBOM data is always
pushed to the registries.</p></div>
<div class="ulist"><ul>
<li>
<p>
ympdist:NAME
</p>
</li>
</ul></div>
<div class="paragraph"><p>Defines the distversion to be used in group element of ymp files. This
is used by the installer to check if the repository is suitable for the
installed distribution. (OBS 2.11 or later)</p></div>
<div class="ulist"><ul>
<li>
<p>
singleexport
</p>
</li>
</ul></div>
<div class="paragraph"><p>If multiple packages contain different versions of a rpm package, only
publish the one from the first package. If the project is of the type
<code>maintenance_release</code>, this will be the package with the highest
incident number.</p></div>
<div class="ulist"><ul>
<li>
<p>
artifacthub:REG_REPO:ID:[NAME[:EMAIL]]
</p>
</li>
</ul></div>
<div class="paragraph"><p>Specify data for artifacthub repository verification. This will
be added to the registry repository when pushing a container to
it.</p></div>
</div>
<div class="sect3">
<h4 id="_registryurl_url">3.2.25. RegistryURL: URL</h4>
<div class="paragraph"><p>Define a url for the downloading of containers.</p></div>
</div>
<div class="sect3">
<h4 id="_repotype_type_options">3.2.26. Repotype: TYPE[:OPTIONS]</h4>
<div class="paragraph"><p>Defines the repository format for published repositories. Valid values
are: <code>none</code>, <code>rpm-md</code>, <code>suse</code>, <code>debian</code>, <code>hdlist2</code>, <code>arch</code>, <code>staticlinks</code>
and vagrant. Multiple types can be specified to generate more than
one metadata type.</p></div>
<div class="paragraph"><p>The OPTIONS parameter depends on the repository type, for rpm-md the
known options are <code>legacy</code> to create the old rpm-md format, <code>deltainfo</code>
or <code>prestodelta</code> to create delta rpm packages, <code>rsyncable</code> to use
rsyncable gzip compression.</p></div>
<div class="paragraph"><p>To split the debug packages in an own published repository the type
<code>splitdebug:REPOSITORY_SUFFIX</code> can be appended, e.g.:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Repotype: rpm-md splitdebug:-debuginfo</code></pre>
</div></div>
<div class="paragraph"><p>This results in a debuginfo package repository being created in parallel
to the package repository.</p></div>
</div>
<div class="sect3">
<h4 id="_repourl_type_url">3.2.27. RepoURL: [TYPE@]URL</h4>
<div class="paragraph"><p>Define a url for the downloading of repository packages. Supported types
are currently <code>arch</code>, <code>debian</code>, <code>hdlist2</code>, <code>rpmmd</code>, <code>suse</code>. If the
type is not specified, it is guessed from the build type.</p></div>
</div>
<div class="sect3">
<h4 id="_required_package">3.2.28. Required: PACKAGE</h4>
<div class="paragraph"><p>Specify a package that always is installed for package builds.
A change in one of these packages triggers a new build.</p></div>
</div>
<div class="sect3">
<h4 id="_runscripts_package">3.2.29. Runscripts: PACKAGE</h4>
<div class="paragraph"><p>Execute the scriptlets of the specified preinstalled package. Scriptlet
execution takes place after the preinstall phase, but before installing
the remaining packages.</p></div>
</div>
<div class="sect3">
<h4 id="_substitute_old_dependency_new_dependency_8230">3.2.30. Substitute: OLD_DEPENDENCY [NEW_DEPENDENCY&#8230; ]</h4>
<div class="paragraph"><p>It is possible to replace BuildRequires dependencies with other
dependencies. This will have only an effect on directly BuildRequired
packages, not on indirectly required packages.</p></div>
</div>
<div class="sect3">
<h4 id="_support_package">3.2.31. Support: PACKAGE</h4>
<div class="paragraph"><p>Specify a package that always is installed for package builds.
Unlike <code>Required:</code>, a change in one of these packages does not trigger an
automatic rebuild.</p></div>
<div class="paragraph"><p>This is useful for packages that most likely do not influence the build
result, for example <code>make</code> or <code>coreutils</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_target_gnu_triplet">3.2.32. Target: GNU_TRIPLET</h4>
<div class="paragraph"><p>Defines the target architecture via a gnu triplet (not the debian
architecture!). For example <code>arm-linux-gnueabihf</code> for armv7hl builds,
or <code>i686</code> for building i686 packages.</p></div>
</div>
<div class="sect3">
<h4 id="_type_type">3.2.33. Type: TYPE</h4>
<div class="paragraph"><p>Build recipe type. This is the format of the file which provides the
build description (the "build recipe"). This is usually autodetected from
the binary type, but in some rare cases it may be needed to manually
configure the type. Currently the following types are understood:
<code>spec</code>, <code>dsc</code>, <code>arch</code>, <code>kiwi</code>, <code>livebuild</code>, <code>productcompose</code>, <code>preinstallimage</code>.</p></div>
</div>
<div class="sect3">
<h4 id="_vminstall_package">3.2.34. VMInstall: PACKAGE</h4>
<div class="paragraph"><p>Like Preinstall, but these packages get only installed when a virtual
machine like Xen or KVM is used for building. Usually packages like
<code>mount</code> are listed here.</p></div>
</div>
</div>
<div class="sect2">
<h3 id="_macros_definitions_for_the_build_configuration">3.3. Macros Definitions for the build configuration</h3>
<div class="paragraph"><p>You can use rpm macro definitions in the project config to improve
configurability.
Macros are defined with <code>%define</code> or <code>%global</code>. They are only known
in the project configuration but not available when the build is
done.</p></div>
<div class="paragraph"><p>For example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>%define _use_profiler 1</code></pre>
</div></div>
<div class="literalblock">
<div class="content">
<pre><code>%if 0%{?_use_profiler}
Require: gprof
%endif</code></pre>
</div></div>
<div class="paragraph"><p>Another example limiting a line to an architecture:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>%ifarch x86_64
Support: x86_64_only_package
%endif</code></pre>
</div></div>
</div>
<div class="sect2">
<h3 id="_macro_definitions_for_the_build_process">3.4. Macro Definitions for the build process</h3>
<div class="paragraph"><p>To specify macros for the building process, use the <code>Macros:</code>
keyword. All lines after <code>Macros:</code> up to the end of the config
or to a <code>:Macros</code> line are used when parsing the spec file and
also made available to the build by copying them to the <code>.rpmmacros</code>
file in the build root.</p></div>
<div class="paragraph"><p>Example:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Macros:
# add your macro definitions here
%_hardened_build 0
:Macros</code></pre>
</div></div>
<div class="paragraph"><p>Note that the macro lines are copied verbatim, i.e. macro expansion
does not take place.</p></div>
</div>
<div class="sect2">
<h3 id="_building_with_ccache_or_sccache">3.5. Building with ccache or sccache</h3>
<div class="paragraph"><p>The usage of ccache or sccache can be enabled for each package by
seting the <code>useccache:PACKAGE</code> build flag.</p></div>
<div class="paragraph"><p>The ccache package will automatically be installed and configured.
The directory /.ccache/ will be configured as cache
directory. To configure ccache, the file /.ccache/ccache.conf can be
modified as part of the build process by the $BUILD_USER environment
variable.</p></div>
<div class="paragraph"><p>In some cases, there is no archive for the current package, such as when
the package was newly branched or when binaries were deleted. In these
cases, the system will check whether there is a package of the same name
built for the same architecture within one of the repositories
configured in the project&#8217;s meta configuration. If so, the archive of
that package will be used. The repositories will be searched in the
order they are configured in the meta configuration, starting from the
top.</p></div>
<div class="paragraph"><p>An alternative way to enable caching based on build dependencies is to
add "--enable-cache" as dependency, for example via a Substitute rule:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Substitute: gcc-c++ gcc-c++ --enable-ccache</code></pre>
</div></div>
<div class="paragraph"><p>This will always enable ccache when a direct build depdency to gcc-c++
is required.</p></div>
<div class="paragraph"><p>It is also possible to set the type, eg:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>Substitute: cargo cargo --enable-ccache=sccache</code></pre>
</div></div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_functionalities">4. Functionalities</h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="_package_builds">4.1. package builds</h3>
<div class="paragraph"><p>Package builds are supported for rpm, deb, arch and their variations.</p></div>
</div>
<div class="sect2">
<h3 id="_image_builds">4.2. image builds</h3>
</div>
<div class="sect2">
<h3 id="_container_builds">4.3. container builds</h3>
</div>
<div class="sect2">
<h3 id="_cross_architecture_build">4.4. Cross Architecture Build</h3>
<div class="paragraph"><p>Cross architecture builds specify two sets of repositories, one for the build environement
and one for the environment for the build result.</p></div>
<div class="sect3">
<h4 id="_terminology">4.4.1. Terminology</h4>
<div class="paragraph"><p>The terminiology for this is unfortunatly not standarised and various tools have conflicting
defintions.</p></div>
<div class="paragraph"><p>We use the following</p></div>
<div class="sect4">
<h5 id="_host_native_the_architecture_build_environment_which_executes_the_for_example_the_compiler">Host Native: The architecture build environment which executes the for example the compiler.</h5>
<div class="paragraph"><p>cmake is calling this HOST as well (eg. CMAKE_HOST_SYSTEM_PROCESSOR)</p></div>
<div class="paragraph"><p>GNU tools (esp. the configure scripts generated by autoconf) is using BUILD as abbrevasion here</p></div>
</div>
<div class="sect4">
<h5 id="_target_the_architecture_of_the_resulting_binaries">Target: The architecture of the resulting binaries</h5>
<div class="paragraph"><p>cmake has this as default without any abbrevasion (eg. CMAKE_SYSTEM_PROCESSOR)</p></div>
<div class="paragraph"><p>GNU tools (esp. the configure scripts generated by autoconf) is using HOST as abbrevasion here:
The "TARGET" defintion of them is something else, usually only used for compilers
where it defines the target architecture a from a cross build compiler.</p></div>
</div>
<div class="sect4">
<h5 id="_the_compatible_terms_can_be_found_in_the_following_table">The compatible terms can be found in the following table:</h5>
<div class="paragraph"><p>Unfortunatly the naming of architecture areas is not consistent via the various build
tooling. Please find the terminilogy mapping from our "build" script and other toolings
in the list below.</p></div>
<div class="tableblock">
<table rules="all"
width="15%"
frame="border"
cellspacing="0" cellpadding="4">
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<col width="20%" />
<tbody>
<tr>
<td align="left" valign="top"><p class="table">pbuild</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">host</p></td>
<td align="left" valign="top"><p class="table">target</p></td>
<td align="left" valign="top"><p class="table">-/-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">cmake</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">HOST</p></td>
<td align="left" valign="top"><p class="table">default</p></td>
<td align="left" valign="top"><p class="table">-/-</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">GNU</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">build</p></td>
<td align="left" valign="top"><p class="table">host</p></td>
<td align="left" valign="top"><p class="table">target</p></td>
</tr>
<tr>
<td align="left" valign="top"><p class="table">rpm</p></td>
<td align="left" valign="top"><p class="table"></p></td>
<td align="left" valign="top"><p class="table">build</p></td>
<td align="left" valign="top"><p class="table">target</p></td>
<td align="left" valign="top"><p class="table">-/-</p></td>
</tr>
</tbody>
</table>
</div>
<div class="paragraph"><p>Our build script just knows the host and target definition as described above.</p></div>
<div class="paragraph"><p>cmake is similar, just uses different namings.</p></div>
<div class="paragraph"><p>GNU (esp. in automake and autoconf) has actually three definitions, mainly for compiler
toolchain. "build" is the environment which creates binaries. Host are the resulting
binaries. And target is important when these binaries can build binaries as well for
another target.</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_dependency_handling">4.4.2. Dependency handling</h4>
<div class="paragraph"><p>Dependencies need to be resolved always twice during a cross build. One time for the host
architecture and one time for the target architecture. Build dependencies of a package
get only installed for the target architecture by default.</p></div>
<div class="paragraph"><p>However, global rules in the build configuration can get created to modify this behaviour.</p></div>
<div class="sect4">
<h5 id="_alsonative_packages">AlsoNative: PACKAGES</h5>
<div class="paragraph"><p>Can be used to mark a package to get installed into the target and in the host system.</p></div>
</div>
<div class="sect4">
<h5 id="_onlynative_packages">OnlyNative: PACKAGES</h5>
<div class="paragraph"><p>Can be used to to install a package in the hostsystem, but not in the target system. Eg.
for build tooling or code generators.</p></div>
</div>
<div class="sect4">
<h5 id="_the_target_base_system">The target base system</h5>
<div class="paragraph"><p>All packages for a host system which are configured as "Requrired" get installed only in
the host system, but not in the target system. The reason behind is that this packages
are only supposed to be able to execute commands and therefore they are not needed in
the target environment. Only the build dependencies get installed there.</p></div>
<div class="paragraph"><p>However, some distributions may lack a complete set of dependencies (esp. debian based).
In this case the base system for the target system can manually get configured via</p></div>
<div class="paragraph"><p>Substitute: sysroot-packages PACKAGES</p></div>
</div>
</div>
<div class="sect3">
<h4 id="_example_calls_in_spec_files_for_cross_build">4.4.3. Example Calls in spec files for cross build</h4>
<div class="paragraph"><p>Note: the basic design of rpm was the GNU style, but it changed in the way that you have to
      specify the host architecture via %target macro on most distributions:</p></div>
<div class="literalblock">
<div class="content">
<pre><code>./configure --build=%build --host=%target</code></pre>
</div></div>
</div>
</div>
</div>
</div>
</div>
<div id="footnotes"><hr /></div>
<div id="footer">
<div id="footer-text">
Last updated
 2022-09-26 10:26:57 CEST
</div>
</div>
</body>
</html>
